<div id="travel_planner">
  <style>
    #travelForm {
      max-width: 800px;
      margin: 0 auto;
    }
    #travelForm input:focus,
    #travelForm select:focus,
    #travelForm textarea:focus,
    #resume_optimzer #travelPlanOutput {
      outline: 2px solid #007cba;
      outline-offset: 2px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>

  <form id="travelForm">
    <label for="destination">Destination:</label><br />
    <input type="text" id="destination" required style="width:100%; margin-bottom:10px;" aria-describedby="destinationHelp"><br />
    <div id="destinationHelp" style="display:none;">Enter your travel destination</div>

    <label for="startDate">Start Date:</label><br />
    <input type="date" id="startDate" required style="width:100%; margin-bottom:10px;" aria-describedby="startDateHelp"><br />
    <div id="startDateHelp" style="display:none;">Select your travel start date</div>

    <label for="endDate">End Date:</label><br />
    <input type="date" id="endDate" required style="width:100%; margin-bottom:10px;" aria-describedby="endDateHelp"><br />
    <div id="endDateHelp" style="display:none;">Select your travel end date</div>

    <label for="groupSize">Group Size:</label><br />
    <input type="number" id="groupSize" min="1" required style="width:100%; margin-bottom:10px;" aria-describedby="groupSizeHelp"><br />
    <div id="groupSizeHelp" style="display:none;">Enter the number of people traveling</div>

    <button id="submit" type="submit" style="padding: 10px 20px;">Get My Travel Plan</button>
  </form>

  <div id="loadingMsg" style="display:none; text-align:center; margin-top:20px; padding:20px;">
    <div style="display:inline-block; text-align:left;">
      <p>Planning your trip... This may take a few moments.</p>
      <div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 10px auto;"></div>
    </div>
  </div>

  <div id="outputArea" style="display: none; margin-top: 10px;">
    <label for="travelPlanOutput">Your Travel Plan:</label><br />
    <div id="travelPlanOutput" style="white-space: pre-wrap; margin-top: 20px; border:1px solid #ccc; padding:15px;"></div>
  </div>

  <div style="text-align:center; margin-top:15px;">
    <button id="copyToClipboard" style="display:none; padding:10px 20px;">Copy to Clipboard</button>
    <div id="copySuccessMsg" style="display:none; color:green; margin-top:10px;">Travel plan copied to clipboard!</div>
  </div>
</div>

<script>
  let latestTravelPlan = "";

  const loadingMsg = document.getElementById("loadingMsg");
  const outputArea = document.getElementById("outputArea");
  const travelPlanOutput = document.getElementById("travelPlanOutput");
  const copyBtn = document.getElementById("copyToClipboard");

  const travelPlanner = async () => {
    loadingMsg.style.display = "block";
    travelPlanOutput.textContent = "";
    copyBtn.style.display = "none";

    const destination = document.getElementById("destination").value.trim();
    const startDate = document.getElementById("startDate").value.trim();
    const endDate = document.getElementById("endDate").value.trim();
    const groupSize = document.getElementById("groupSize").value;

    // Validation
    if (!destination || !startDate || !endDate || !groupSize || isNaN(Number(groupSize)) || Number(groupSize) < 1) {
      travelPlanOutput.textContent = "Please fill out all fields correctly.";
      outputArea.style.display = "block";
      loadingMsg.style.display = "none";
      return;
    }

    try {
      const response = await fetch("https://resume-refresh-api.vercel.app/api/travel", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          destination, 
          dates: [startDate, endDate],
          groupSize: Number(groupSize)
        })
      });

      const data = await response.json();
      if (data.travelPlan) {
        outputArea.style.display = "block";
        copyBtn.style.display = "inline-block";
        travelPlanOutput.textContent = data.travelPlan;
        latestTravelPlan = data.travelPlan;
      } else {
        travelPlanOutput.textContent = "Sorry, there was a problem processing your travel plan.";
      }
    } catch (err) {
      console.error("Error connecting to the travel service:", err);
      travelPlanOutput.textContent = "Error connecting to the travel service. Please try again later.";
    } finally {
      loadingMsg.style.display = "none";
    }
  };

  document.getElementById("travelForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    await travelPlanner();
  });

  const getTravelPlanText = () => {
    return travelPlanOutput.textContent;
  };

  copyBtn.addEventListener("click", () => {
    const plan = getTravelPlanText();
    const copySuccessMsg = document.getElementById("copySuccessMsg");
    
    navigator.clipboard.writeText(plan)
      .then(() => {
        copySuccessMsg.style.display = "block";
        setTimeout(() => {
          copySuccessMsg.style.display = "none";
        }, 3000);
      })
      .catch(err => {
        console.error("Failed to copy text: ", err);
        alert("Failed to copy text to clipboard. Please try again.");
      });
  });
</script>